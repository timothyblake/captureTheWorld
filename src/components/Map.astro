---
interface Props {
  lat: number;
  lng: number;
  title: string;
  zoom?: number;
}

const { lat, lng, title, zoom = 11 } = Astro.props;

// Calculate dynamic bounding box for OpenStreetMap embed
const offset = 1 / Math.pow(2, zoom - 8);
const minLng = lng - offset;
const maxLng = lng + offset;
// Reduce latitude offset slightly for better proportions
const minLat = lat - offset / 2;
const maxLat = lat + offset / 2;
const bbox = `${minLng},${minLat},${maxLng},${maxLat}`;

const embedUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${bbox}&layer=mapnik&marker=${lat},${lng}`;

const linkUrl = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=${zoom}/${lat}/${lng}`;
---

<section class="border-top py-4">
  <div class="container">
    <h2 class="ff-display h5 mb-3">Location</h2>
    <div class="rounded overflow-hidden border">
      <iframe
        src={embedUrl}
        title={`Map showing the location of ${title}`}
        width="100%"
        height="420"
        style="border:0;display:block;"
        loading="lazy"
        allowfullscreen></iframe>
    </div>
    <p class="mt-2 mb-0 small text-secondary">
      Map data &copy; <a
        href="https://www.openstreetmap.org/copyright"
        target="_blank"
        rel="noopener noreferrer"
        class="text-accent">OpenStreetMap</a
      > contributors &nbsp;&middot;&nbsp;
      <a
        href={linkUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="text-accent">View larger map &rarr;</a
      >
    </p>
  </div>
</section>
