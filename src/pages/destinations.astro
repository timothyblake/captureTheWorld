---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import heroImages from "../data/heroBackgrounds.json";

const albums = (await getCollection("albums")).sort(
    (a, b) => a.data.order - b.data.order,
);

const heroImage =
    heroImages.find((img) => img.tags.includes("destinations"))?.url ||
    heroImages[0]?.url;

const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        {
            "@type": "ListItem",
            position: 1,
            name: "Home",
            item: "https://capturetheworld.co.uk/",
        },
        {
            "@type": "ListItem",
            position: 2,
            name: "Albums",
            item: "https://capturetheworld.co.uk/destinations",
        },
    ],
};
---

<BaseLayout
    title="All Albums â€“ Capture The World"
    description="Explore the complete collection of travel photography albums from around the globe."
>
    <script
        slot="head"
        is:inline
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />
    <main>
        <Hero
            title="All Albums"
            description="A complete archive of places photographed across the world."
            heroImage={heroImage}
            location="World"
        />

        <!-- Breadcrumb -->
        <nav class="breadcrumb-bar" aria-label="Breadcrumb">
            <div class="container">
                <ol class="breadcrumb mb-0 py-3 small">
                    <li class="breadcrumb-item">
                        <a href="/" class="text-accent">Home</a>
                    </li>
                    <li
                        class="breadcrumb-item active text-secondary"
                        aria-current="page"
                    >
                        Albums
                    </li>
                </ol>
            </div>
        </nav>

        <section class="py-4 py-lg-5" id="all-destinations">
            <div class="container-xl">
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {
                        albums.map((album) => (
                            <div class="col">
                                <a
                                    href={`/album/${album.id}`}
                                    class="album-card card h-100 border"
                                    data-astro-prefetch="viewport"
                                >
                                    <div
                                        class="ratio overflow-hidden"
                                        style="--bs-aspect-ratio: 62.5%"
                                    >
                                        <img
                                            src={
                                                album.data.thumbnail ??
                                                album.data.heroImage
                                            }
                                            alt={album.data.title}
                                            class="object-fit-cover w-100 h-100 card-img"
                                            loading="lazy"
                                            decoding="async"
                                        />
                                    </div>
                                    <div class="card-body d-flex flex-column">
                                        <p class="text-accent small fw-semibold text-uppercase ls-wide mb-1">
                                            {album.data.location}
                                        </p>
                                        <h3 class="ff-display card-title h5 mb-2">
                                            {album.data.title}
                                        </h3>
                                        <p class="card-text text-secondary small flex-grow-1 mb-3">
                                            {album.data.description}
                                        </p>
                                        <span class="btn btn-accent btn-sm mt-auto align-self-start">
                                            Read more
                                        </span>
                                    </div>
                                </a>
                            </div>
                        ))
                    }
                </div>
            </div>
        </section>
    </main>
</BaseLayout>

<style>
    .breadcrumb-bar {
        border-bottom: 1px solid var(--bs-border-color);
    }

    .breadcrumb-item + .breadcrumb-item::before {
        color: var(--bs-secondary-color);
    }

    .album-card {
        transition:
            transform 0.25s ease,
            border-color 0.25s ease;
    }
    .album-card:hover {
        transform: translateY(-4px);
        border-color: var(--accent) !important;
    }
    .album-card .card-img {
        transition: transform 0.4s ease;
    }
    .album-card:hover .card-img {
        transform: scale(1.04);
    }
    .album-card .btn-accent {
        transition:
            background-color 0.25s ease,
            color 0.25s ease;
    }
    .album-card:hover .btn-accent {
        background-color: transparent;
        color: var(--accent);
    }
    .ls-wide {
        letter-spacing: 0.1em;
    }
</style>

<script>
    function shuffleGrid() {
        const grid = document.querySelector<HTMLElement>(
            "#all-destinations .row",
        );
        if (!grid) return;
        const cards = [...grid.children] as HTMLElement[];
        // Fisher-Yates shuffle
        for (let i = cards.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [cards[i], cards[j]] = [cards[j], cards[i]];
        }
        cards.forEach((card) => grid.appendChild(card));
    }

    document.addEventListener("astro:page-load", shuffleGrid);
</script>
